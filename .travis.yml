script:
  - docker network create dohli
  - docker run -d --rm --network dohli --name redis redis:alpine
  - docker build -t dohli .
  - docker run -d --rm --network dohli -p 8080:8080 -e PORT=8080 -e REDIS_URL=redis://redis dohli /web
  - docker run -d --rm --network dohli -e REDIS_URL=redis://redis dohli /worker
  - sleep 2
  - echo AAABAAABAAAAAAAABGlwdjYGZ29vZ2xlA2NvbQAAAQAB | base64 -d > /tmp/request
  - curl -f -o /dev/null --data-binary @/tmp/request http://localhost:8080/dns-query

services:
  - docker

deploy:
  provider: heroku
  api_key:
    secure: "h4G4uHA7hpbmpj2CrTUbiqtrrbYmpqHroPKMI+XI0xriVPha9lHkSFK8KyWvIAOjSCqD5K6wpaP2b/modAT2lylqqza2sa/XTJcUuST5lfRfRymZWkjXxQTtF//sRKNQHCWyU25BXtTVBxWR6zEvbNq0fkLlk+Oz37UWIzOxBsxpEpanl2Y/q0HoXKY2HVnM0i9NMjUEJMYuOZqjkbbbvs/6/dKOrfXm0g3heZr3X7ScpOkmCGejSjoTHE6PGPOZGky/6BUNiHGdzGAeHVng9ysa2w8Jt37kPPSGqP+/Umef9KHCuWykdTGWiv65dEFzOx+2SFKQBoVjGh6qydGXFj0rwICABL/4aronp8FAGw6Mq5bfcvnC4S1xnEpVvK4GUIQiEoaOBa2hfts3/Kl+uhNYSygwncpN1vqt3M8ZKGqLxnlbz0YZwVEz2OmmLKsHt5m3LhlfIX5UyLmgla+6k+yqXhnP0NSlPr0HyCsa9f9V3b3Pi6tDpjrjacRhb2CntvR47ellyW/6t6iqmWkcQX42iuWh51gLPXlEPIRYAueQZ8DV6pAMkI3O2igaw44zGcYzH98cp9HYZv0h4ihIYm2qrfNGn+DVMF79NobONTd7/tYBp3p83oONiJfnjZnnUcraCm/PuQeFuZCSy59r2jx7ZMOYIIiejOxTVscSuIU="
  on:
    branch: master